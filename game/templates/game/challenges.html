<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Challenge</title>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <style>
        .level {
            background-color: #0610FB;
            font-size: 5vh;
        }
        .category {
            background-color: #00008b;
            font-size: 7vh;
        }
	.prize{
	    cursor:pointer;
	}
	.solved{
	    background-color:#007bff;
	    border-color:#007bff;
	}
        #page_title {
            font-size: 10vh;
            color: #0610FB;
        }
        #session {
            color:#0610FB;
        }
        #warning {
            color: #0610FB;
            font: Montserrat;
            bold: 700;
            font-size: 17vh;
        }
        .no-click {
            pointer-events: none;
        }
        #fruit {
            position: absolute;
            top: 25px;
            left: 170px;
	    width:120px;
        }
        #hat {
            position: absolute;
            top: 0px;
            left: 190px;
	    width:80px;
        }
        #shoe {
            position: absolute;
            top: 95px;
            left: 190px;
	    width:60px;
        }
        #face {
            position: absolute;
            top: 55px;
            left: 200px;
	    width:60px;
        }
        body {
            min-height: 600px;
        }
    </style>
</head>
<body>
    {% if user.is_authenticated %}
    {% csrf_token %}
    <section class="text-center container-fluid">
        <section class="row">
            <section class="col-md-12">
				<img id="fruit" src="{{fruit}}">
				<img id="hat" src="{{hat}}">
				<img id="shoe" src="{{shoes}}">
				<img id="face" src="{{face}}">
            </section>
        </section>
        <section class="row">
            <section class="col-md-12">
                <h3 id="page_title">Jeopardy Game</h3>
		<p id="session">Welcome, {{ user.get_username }}! Score: {{ score }}</p>
            </section>
        </section>
    </section>
    <br/>
    <section class="text-center container-fluid">
	<section id="container"></section>
        <section class="row">
            <section class="col-md-3">
                <button class="btn btn-primary btn-block category no-click">Shell</button>
            </section>
            <section class="col-md-3">
                <button class="btn btn-primary btn-block category no-click">Encoding</button>
            </section>
             <section class="col-md-3">
                <button class="btn btn-primary btn-block category no-click">Networks</button>
            </section>
            <section class="col-md-3">
                <button class="btn btn-primary btn-block category no-click">Web</button>
            </section>
        </section>
        <br/>
	{% for chal in challenges %}
		{% if forloop.counter0|divisibleby:4 %}
			{% if forloop.counter0 != 0 %}
        			</section>
				<br>
			{% endif %}
			{% if forloop.counter0 != challenges|length %}
        			<section class="row">
			{% endif %}
		{% endif %}
            <section class="col-md-3">
		    <button class="btn btn-primary btn-block level chalbtn {% if chal.solved == True %}solved{% endif %}" solved="{{ chal.solved }}" id = "{{ chal.id }}" name = "{{ chal.name }}" desc = "{{ chal.desc }}" data-toggle="modal" data-target="#myModal">{{ chal.points}}</button>
            </section>
	{% endfor %}
    </section>
    {% else %}
        <p id="warning">You must be logged in to continue playing the game. Sign in <a href="../login">here.</a></p>
    {% endif %}
</body>
<script type="text/javascript" src="/static/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/static/popper.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
<script>
	function addPrize(e){
		console.log(e,this);
		const target = e.target;
		const id = target.id;
		const src = target.getAttribute('src');
		const challengeId = target.getAttribute('challengeId');
		fetch('/chooseprize/',{
			method: 'POST',
			headers:{
				'Content-Type': 'application/json'
			},
			body:JSON.stringify({
				challengeId,
				id,
				src
			})

		}).then(res=>res.json()).then(res=>{
			console.log(res);
			window.location.reload();
		}).catch(e=>{
			console.error(e)
		});
	}
(function($) {
    var cont = $('#container');
  $('.chalbtn').on('click', function() {
	  	chalbtn = this;
                htmlData = this.getAttribute('name');
                descrip = this.getAttribute('desc');
	  	id = this.id
	  	solved = this.getAttribute('solved') === 'True';
	  	//my fix for this isn't clean by any means and would love to think about rewriting in the spring if there is time
	  	if(solved)
	  		container.innerHTML = '<div class="modal" id="myModal0"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="title0">'+ htmlData + '</h4><button class="close" id="close0" data-dismiss="modal">&times;</button></div><div class="modal-body" id="body0">'+descrip+'<br/><br/></div><div class="modal-footer" id="footer0"><button class="btn btn-primary" data-dismiss="modal" id="done1">Solved</button></div></div></div></div>'
	  	else
	  		container.innerHTML = '<div class="modal" id="myModal0"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="title0">'+ htmlData + '</h4><button class="close" id="close0" data-dismiss="modal">&times;</button></div><div class="modal-body" id="body0">'+descrip+'<br/><br/>Answer: <input type="text" id="input0"></div><div class="modal-footer" id="footer0"><button class="btn btn-primary"  id="done0">Check Answer</button></div></div></div></div>'

                $("#myModal0").modal('show');
                $('#close0').on('click', function() {
                    $("#myModal0").modal('hide');
                })
                $('#done0').on('click',  function() {
			fetch('/submitchal/',{
				method: 'POST',
				headers:{
					'Content-Type': 'application/json'
				},
				body:JSON.stringify({
					id,
					flag: $('#input0').val()
				})

			}).then(res=>res.json()).then(res=>{
				console.log(res);
				if(res.success){
				    $('#title0').html("You Won!");
					const prizes = res.prizes.map(prize=>`<li style="list-style-type: none;"><img class="prize" challengeId="${id}" id="${prize.id}" src="${prize.url}" width="100" height="100" ></li>`);
					$('#body0').html(`<ul style="list-style-type: none;">${prizes.join('OR')}</ul>`)
					$('.prize').on('click',addPrize);
				    $('#done0').remove();
				    $('#footer0').html('<button class="btn btn-primary" data-dismiss="modal" id="finish0">Skip</button>')
				    $('#finish0').on('click', function() {
					$('#0').css("background-color", "#00008b");
					$('#0').html('<img src="/static/checkmark.webp" width="50" height="50">')
					$('#0').addClass("no-click");
					$("#myModal0").modal('hide');
				    })
				    chalbtn.disabled = true;
				} else {
					$('#input0').css("border", "1px solid red");
					$('#footer0').html('<button class="btn btn-primary" data-dismiss="modal" id="done0">Try Again</button>')
				}
			}).catch(e=>{
				console.error(e)
			});

                })
        return false;
    })
})(jQuery);
</script>
</html>
